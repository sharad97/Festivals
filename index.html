<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nepal Festivals</title>
  <style>
    /* ========== BASIC STYLES ========== */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    /* ========== SEARCH ========== */
    .search-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    #searchInput {
      width: 80%;
      max-width: 500px;
      padding: 8px;
      font-size: 16px;
    }

    /* ========== FESTIVAL LIST ========== */
    #festivalList {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 16px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .festival-card {
      background: #fff;
      padding: 16px;
      cursor: pointer;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .festival-card:hover {
      transform: translateY(-3px);
    }

    .festival-card h2 {
      margin: 0 0 8px 0;
      font-size: 1.2em;
    }

    /* ========== PAGINATION ========== */
    #paginationControls {
      text-align: center;
      margin: 20px 0;
      display: flex;
      flex-wrap: wrap; /* So they can wrap on small screens */
      gap: 6px;
      justify-content: center;
    }
    .page-button {
      padding: 6px 12px;
      border: none;
      background: #ddd;
      cursor: pointer;
      border-radius: 4px;
    }
    .page-button.active {
      background: #666;
      color: #fff;
    }
    .page-button.disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .ellipsis {
      background: transparent;
      border: none;
      cursor: default;
    }

    /* ========== MODAL ========== */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; 
      z-index: 9999; 
      left: 0;
      top: 0;
      width: 100%; 
      height: 100%; 
      overflow: auto; 
      background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
      background-color: #fff;
      margin: 80px auto;
      padding: 20px;
      max-width: 800px; /* Widened for large descriptions */
      position: relative;
      border-radius: 4px;
    }

    .close-button {
      position: absolute;
      right: 20px;
      top: 20px;
      font-size: 20px;
      cursor: pointer;
      background: none;
      border: none;
    }

    .images-container img {
      max-width: 100%;
      display: block;
      margin: 10px 0;
    }

    .videos-container video {
      width: 100%;
      display: block;
      margin: 10px 0;
    }

    .back-button {
      margin-top: 20px;
      padding: 8px 16px;
      cursor: pointer;
      background: #ddd;
      border: none;
      border-radius: 4px;
    }

    /* ========== MOBILE-FRIENDLY ========== */
    @media (max-width: 600px) {
      .festival-card {
        font-size: 14px;
      }
      .modal-content {
        width: 90%;
      }
    }
  </style>
</head>

<body>
  <h1>Nepal’s Festivals & Jatras</h1>

  <!-- Search bar -->
  <div class="search-container">
    <input
      type="text"
      id="searchInput"
      placeholder="Search by month, ethnic group, or festival name..."
    />
  </div>

  <!-- Festivals list -->
  <div id="festivalList"></div>

  <!-- Pagination Controls -->
  <div id="paginationControls"></div>

  <!-- Modal for festival details -->
  <div id="festivalModal" class="modal">
    <div class="modal-content">
      <button id="closeModal" class="close-button">X</button>
      
      <h2 id="modalFestivalName"></h2>
      <p><strong>Month / Timing:</strong> <span id="modalMonth"></span></p>
      <p><strong>Ethnic Group:</strong> <span id="modalEthnicGroup"></span></p>
      <p><strong>Location(s):</strong> <span id="modalLocation"></span></p>
      <div id="modalDescription"></div>

      <!-- Placeholder for images -->
      <div id="modalImages" class="images-container"></div>

      <!-- Placeholder for videos -->
      <div id="modalVideos" class="videos-container"></div>

      <button id="modalBackBtn" class="back-button">Back</button>
    </div>
  </div>

  <script>
    /* 
      FESTIVAL DATA
      --------------
      Each festival object includes:
        - id
        - name
        - month (approximate Gregorian month, or phrase like "Mid-January")
        - ethnicGroup (e.g., "Nationwide," "Newar," "Tamang," etc.)
        - location (short note about where it's mainly observed)
        - description (all the details from your text)
        - images: [] (placeholder)
        - videos: [] (placeholder)
      
      Searching will match 'name', 'month', or 'ethnicGroup' (case-insensitive).
    */

    const festivalData = [
      // ===== 2.1 Maghe Sankranti =====
      {
        id: 1,
        name: "Maghe Sankranti",
        month: "Mid-January (1st day of Magh)",
        ethnicGroup: "Nationwide (Hindu communities)",
        location: "Nationwide (notably Devghat, Triveni)",
        description: `
<b>Significance:</b>
• Marks the Sun’s entry into Capricorn, beginning warmer days.
• Symbolically ends the coldest month in hill regions.
<b>Legends & Beliefs:</b>
• Connected to Bhisma Pitamah’s moksha in the Mahabharata.
• Holy bath believed to cleanse sins.
<b>Rituals & Observances:</b>
• Early morning holy bath.
• Family feasts featuring til ko laddu, chaaku, sweet potatoes, yams.
<b>Foods & Special Activities:</b>
• Sesame (til) sweets for warmth, possible local fairs.
        `,
        images: [],
        videos: []
      },
      // ===== 2.2 Shree Panchami (Saraswati Puja) =====
      {
        id: 2,
        name: "Shree Panchami (Saraswati Puja)",
        month: "January/February",
        ethnicGroup: "Nationwide (all communities, especially students)",
        location: "Schools, colleges, temples",
        description: `
<b>Significance:</b>
• Dedicated to Goddess Saraswati, patroness of knowledge, music, arts.
• Auspicious day for learning.
<b>Rituals & Observances:</b>
• Pujas at educational institutions.
• Books and musical instruments placed on the altar.
• Many children learn their first letters (Hate Lakhe).
<b>Foods & Activities:</b>
• Sweets (sel roti, halwa), cultural programs, poetry recitals.
        `,
        images: [],
        videos: []
      },
      // ===== 2.3 Maha Shivaratri =====
      {
        id: 3,
        name: "Maha Shivaratri",
        month: "February/March (Falgun Krishna Chaturdashi)",
        ethnicGroup: "Nationwide (Hindu devotees)",
        location: "Major celebration at Pashupatinath, Kathmandu",
        description: `
<b>Significance:</b>
• Honors Lord Shiva, associated with creation and destruction.
• Believed to be Shiva’s wedding night or day of cosmic dance.
<b>Rituals & Observances:</b>
• All-night vigils, fasting or minimal food.
• Bonfires, chanting "Om Namah Shivaya."
<b>Foods & Activities:</b>
• Bhang (cannabis) often consumed as prasad.
• Large pilgrim gatherings at Pashupatinath Temple.
        `,
        images: [],
        videos: []
      },
      // ===== 2.4 Holi (Fagu Purnima) =====
      {
        id: 4,
        name: "Holi (Fagu Purnima)",
        month: "March (Full Moon of Falgun)",
        ethnicGroup: "Nationwide",
        location: "Cities, towns, villages across Nepal",
        description: `
<b>Significance:</b>
• Festival of colors, celebrating the onset of spring.
• Symbolic victory of good over evil (Holika & Prahlad legend).
<b>Rituals & Observances:</b>
• Throwing colored powders, water balloons.
• Street parties, music, dancing.
<b>Foods & Activities:</b>
• Gujiya (sweet dumplings), local variations in Tarai communities.
• Emphasis on using safe, natural colors.
        `,
        images: [],
        videos: []
      },
      // ===== 2.5 Ram Navami =====
      {
        id: 5,
        name: "Ram Navami",
        month: "March/April (Chaitra Shukla Navami)",
        ethnicGroup: "Nationwide (Hindu)",
        location: "Janakpur (Janaki Temple), throughout Nepal",
        description: `
<b>Significance:</b>
• Birth anniversary of Lord Rama.
• Tied to the epic Ramayana.
<b>Rituals & Observances:</b>
• Temple visits, Ramayana recitations.
• Some observe a day-long fast.
• Janakpur hosts chariot processions of Rama-Sita idols.
        `,
        images: [],
        videos: []
      },
      // ===== 2.6 Chaite Dashain =====
      {
        id: 6,
        name: "Chaite Dashain",
        month: "March/April (Chaitra)",
        ethnicGroup: "Nationwide (Hindu communities)",
        location: "Throughout Nepal",
        description: `
<b>Significance:</b>
• Smaller “spring” Dashain dedicated to Goddess Durga.
• Less grand but still important for families.
<b>Rituals:</b>
• Worship at Durga temples, sometimes animal sacrifice.
• Family feasts, gatherings.
        `,
        images: [],
        videos: []
      },
      // ===== 2.7 Nepali New Year (Baisakh 1) =====
      {
        id: 7,
        name: "Nepali New Year (Baisakh 1)",
        month: "Mid-April",
        ethnicGroup: "Nationwide (official start of Bikram Sambat)",
        location: "Throughout Nepal",
        description: `
<b>Significance:</b>
• Marks the start of the Bikram Sambat calendar.
<b>Rituals & Observances:</b>
• Exchanging good wishes, family picnics, temple visits.
• Many buy new clothes.
<b>Local Tie-Ins:</b>
• Coincides with Bisket Jatra in Bhaktapur.
        `,
        images: [],
        videos: []
      },
      // ===== 2.8 Buddha Jayanti =====
      {
        id: 8,
        name: "Buddha Jayanti",
        month: "April/May (Full Moon of Baisakh)",
        ethnicGroup: "Nationwide (Buddhist/Hindu), global significance",
        location: "Lumbini, Swayambhunath, Boudhanath",
        description: `
<b>Significance:</b>
• Commemorates the birth, enlightenment, and death of Lord Buddha.
<b>Rituals & Observances:</b>
• Peaceful processions, chanting sutras, lighting butter lamps.
• Charitable acts, free meals (Buddha Bhojan).
        `,
        images: [],
        videos: []
      },
      // ===== 2.9 Mata Tirtha Aunsi (Mother’s Day) =====
      {
        id: 9,
        name: "Mata Tirtha Aunsi (Mother’s Day)",
        month: "April/May (New Moon of Baisakh)",
        ethnicGroup: "Nationwide",
        location: "Mata Tirtha near Kathmandu (pilgrimage), households",
        description: `
<b>Significance:</b>
• Day to honor mothers (living or deceased).
<b>Rituals & Observances:</b>
• Gifts, special meals for living mothers.
• Pilgrimage to Mata Tirtha for ancestor rites if mother is deceased.
        `,
        images: [],
        videos: []
      },
      // ===== 2.10 Ropain Jatra (Asar 15) =====
      {
        id: 10,
        name: "Ropain Jatra (Asar 15)",
        month: "June/July",
        ethnicGroup: "Primarily farming communities (hill regions)",
        location: "Rural districts, outskirts of Kathmandu Valley",
        description: `
<b>Significance:</b>
• Marks the start of rice planting season.
<b>Rituals & Observances:</b>
• Farmers gather in muddy fields, transplant seedlings.
• Singing folk songs, mud-play, and dance.
<b>Food Tradition:</b>
• Dahi Chiura (curd & beaten rice) to keep cool and energized.
        `,
        images: [],
        videos: []
      },
      // ===== 2.11 Nag Panchami =====
      {
        id: 11,
        name: "Nag Panchami",
        month: "July/August",
        ethnicGroup: "Nationwide (Hindu households)",
        location: "Homes, snake temples, water sources",
        description: `
<b>Significance:</b>
• Worship of serpent deities (Nagas).
• Believed to ensure protection from snakes and water shortages.
<b>Rituals & Observances:</b>
• People paste snake pictures on doorways.
• Offerings of milk/rice to serpent gods.
        `,
        images: [],
        videos: []
      },
      // ===== 2.12 Gai Jatra =====
      {
        id: 12,
        name: "Gai Jatra",
        month: "August (day after Janai Purnima in Kathmandu Valley)",
        ethnicGroup: "Newar communities",
        location: "Kathmandu, Bhaktapur, Patan",
        description: `
<b>Significance:</b>
• Commemorates deceased family members of the past year, guided by a sacred cow.
• Known for comedic street performances to ease grief.
<b>Rituals & Observances:</b>
• Processions of children or cow effigies.
• Satire, cross-dressing, comedic skits.
        `,
        images: [],
        videos: []
      },
      // ===== 2.13 Janai Purnima (Raksha Bandhan) =====
      {
        id: 13,
        name: "Janai Purnima (Raksha Bandhan)",
        month: "August (Full Moon)",
        ethnicGroup: "Nationwide (Hindu)",
        location: "Kumbheshwar Temple (Patan), other temples",
        description: `
<b>Significance:</b>
• Renewal of the sacred thread (janai).
• Tying raksha bandhan on wrists for protection.
<b>Rituals & Observances:</b>
• Sacred thread changing ceremony.
• Priests tie raksha bandhan on devotees.
• Kwati (mixed bean soup) is a special dish.
        `,
        images: [],
        videos: []
      },
      // ===== 2.14 Teej =====
      {
        id: 14,
        name: "Teej",
        month: "August/September",
        ethnicGroup: "Hindu women (nationwide)",
        location: "Pashupatinath Temple, homes",
        description: `
<b>Significance:</b>
• Women-centric festival dedicated to Goddess Parvati & Lord Shiva.
• Prayers for marital bliss and husband's well-being.
<b>Rituals & Observances:</b>
• Day-long fast (often no water).
• Singing & dancing in red saris.
• Dar (hearty meal) the night before.
        `,
        images: [],
        videos: []
      },
      // ===== 2.15 Father’s Day (Gokarna Aunsi) =====
      {
        id: 15,
        name: "Father’s Day (Gokarna Aunsi)",
        month: "August/September (New Moon of Bhadra)",
        ethnicGroup: "Nationwide",
        location: "Gokarneshwar Temple (Kathmandu)",
        description: `
<b>Significance:</b>
• Honors fathers, living or deceased.
<b>Rituals & Observances:</b>
• Gifts, special meals for living fathers.
• Ancestor rites at Gokarneshwar if father is deceased.
        `,
        images: [],
        videos: []
      },
      // ===== 2.16 Indra Jatra (7–8 Days) =====
      {
        id: 16,
        name: "Indra Jatra",
        month: "August/September (Bhadra)",
        ethnicGroup: "Newar (Kathmandu), city-wide",
        location: "Kathmandu (Basantapur, Ason, Indra Chowk)",
        description: `
<b>Significance:</b>
• Celebrates Indra, the god of rain, and includes Kumari chariot processions.
<b>Rituals & Observances:</b>
• Erection of Yosin (wooden pole).
• Kumari, Bhairav, Ganesh chariot tours.
• Pulukisi (elephant) dance in the streets.
        `,
        images: [],
        videos: []
      },
      // ===== 2.17 Dashain (Mohani) (15 Days) =====
      {
        id: 17,
        name: "Dashain (Mohani)",
        month: "September/October (Ashwin/Kartik)",
        ethnicGroup: "Nationwide (Hindu households)",
        location: "All over Nepal",
        description: `
<b>Significance:</b>
• The grandest Hindu festival, celebrating Goddess Durga’s victory.
• Major family reunions, blessings, feasts.
<b>Key Days:</b>
• Ghatasthapana (day 1): Sowing jamara.
• Maha Ashtami & Mahanavami: Intense Durga worship, animal sacrifices in some areas.
• Vijaya Dashami (day 10): Receiving tika & jamara from elders, major travel day.
• Kojagrat Purnima (day 15): Worship of Laxmi, staying awake for prosperity.
<b>Foods & Activities:</b>
• Goat meat (khasi), sel roti, sweets, card games, kite flying.
        `,
        images: [],
        videos: []
      },
      // ===== 2.18 Tihar (Deepawali) (5 Days) =====
      {
        id: 18,
        name: "Tihar (Deepawali)",
        month: "October/November (Kartik)",
        ethnicGroup: "Nationwide",
        location: "All over Nepal",
        description: `
<b>Significance:</b>
• “Yamapanchak,” festival of lights honoring various animals, Laxmi, and sibling bond.
<b>Day-by-Day:</b>
1) Kag Tihar (crows),
2) Kukur Tihar (dogs),
3) Gai Tihar & Laxmi Puja (cows, goddess of wealth),
4) Govardhan Puja / Mha Puja (Newar self-worship),
5) Bhai Tika (brother-sister).
<b>Highlights:</b>
• Sel roti, lights, marigold garlands, Deusi-Bhailo singing.
        `,
        images: [],
        videos: []
      },
      // ===== 2.19 Chhath Puja (4 Days) =====
      {
        id: 19,
        name: "Chhath Puja",
        month: "October/November",
        ethnicGroup: "Tarai communities (Maithili, Tharu)",
        location: "Riverbanks in Tarai, also Kathmandu (Bagmati, etc.)",
        description: `
<b>Significance:</b>
• Dedicated to Surya (Sun God) for health, prosperity.
• Major festival in the Tarai region.
<b>Outline (4 Days):</b>
• Nahay Khay, Kharna, Sandhya Arghya, Usha Arghya.
• Devotees fast, offer fruits and sweets to the setting/rising sun.
        `,
        images: [],
        videos: []
      },
      // ===== 2.20 Bala Chaturdashi =====
      {
        id: 20,
        name: "Bala Chaturdashi",
        month: "November/December (Marga Krishna Chaturdashi)",
        ethnicGroup: "Hindu (ancestor remembrance)",
        location: "Pashupatinath Temple, Kathmandu",
        description: `
<b>Significance:</b>
• Scattering of sat biu (seven types of seeds) to honor departed souls.
<b>Rituals & Observances:</b>
• Night-long vigil around Pashupatinath.
• Morning procession scattering seeds at shrines.
        `,
        images: [],
        videos: []
      },
      // ===== 2.21 Yomari Punhi =====
      {
        id: 21,
        name: "Yomari Punhi",
        month: "November/December (Full Moon of Thinla in Nepal Sambat)",
        ethnicGroup: "Newar",
        location: "Kathmandu Valley (esp. Newar towns)",
        description: `
<b>Significance:</b>
• Celebrates the end of the rice harvest.
• Honors Goddess Annapurna.
<b>Rituals & Observances:</b>
• Making Yomari (steamed dumplings with sweet fillings).
• House-to-house sharing among neighbors.
        `,
        images: [],
        videos: []
      },

      // ===== 3.1 Sonam Lhosar (Tamang New Year) =====
      {
        id: 22,
        name: "Sonam Lhosar (Tamang New Year)",
        month: "January/February",
        ethnicGroup: "Tamang communities",
        location: "Around Kathmandu & central hills (Tamang settlements)",
        description: `
<b>Significance:</b>
• Tamang lunar New Year.
• Showcases Tamang heritage with music & dance.
<b>Key Activities:</b>
• Tamang Selo with damphu drum.
• Traditional attire, monastery offerings.
        `,
        images: [],
        videos: []
      },
      // ===== 3.2 Gyalpo Lhosar (Sherpa/Himalayan New Year) =====
      {
        id: 23,
        name: "Gyalpo Lhosar (Sherpa/Himalayan New Year)",
        month: "February/March",
        ethnicGroup: "Sherpa, other Himalayan communities",
        location: "Everest region, also Kathmandu",
        description: `
<b>Significance:</b>
• Marks the Sherpa (and Himalayan) lunar new year.
• Religious observances in monasteries.
<b>Key Activities:</b>
• Masked dances (Cham), "Tashi Delek" greetings.
• Khapse (fried pastry), butter tea, family gatherings.
        `,
        images: [],
        videos: []
      },
      // ===== 3.3 Tamu Lhosar (Gurung New Year) =====
      {
        id: 24,
        name: "Tamu Lhosar (Gurung New Year)",
        month: "December/January",
        ethnicGroup: "Gurung (Tamu) communities",
        location: "Kaski, Lamjung, Gorkha, Kathmandu events",
        description: `
<b>Significance:</b>
• Gurung lunar New Year.
• Emphasis on clan unity, ancestor remembrance.
<b>Celebrations:</b>
• Ghatu dance, rodhi gatherings.
• Feasts with sel roti, achaar, millet bread.
        `,
        images: [],
        videos: []
      },
      // ===== 3.4 Ubhauli & Udhauli (Sakela) (Kirat) =====
      {
        id: 25,
        name: "Ubhauli & Udhauli (Sakela)",
        month: "Ubhauli: Apr/May, Udhauli: Nov/Dec",
        ethnicGroup: "Kirat (Rai, Limbu, Sunuwar, Yakha)",
        location: "Eastern hills",
        description: `
<b>Significance:</b>
• Seasonal migration celebrations (uphill in summer, downhill in winter).
• Sakela or Sili dances honoring nature & ancestors.
<b>Rituals:</b>
• Circle dances, wearing ethnic dress.
• Offerings for a bountiful harvest.
        `,
        images: [],
        videos: []
      },
      // ===== 3.5 Sita Vivaha Panchami =====
      {
        id: 26,
        name: "Sita Vivaha Panchami",
        month: "November/December (Margashirsha Shukla Panchami)",
        ethnicGroup: "Hindu (especially in Mithila region)",
        location: "Janakpur",
        description: `
<b>Significance:</b>
• Re-enacts the wedding of Lord Rama & Goddess Sita.
<b>Main Observances:</b>
• Grand procession (barat) from Ram Temple to Janaki Temple.
• Symbolic marriage ceremony at Janaki Temple.
        `,
        images: [],
        videos: []
      },
      // ===== 3.6 Gaura Parva =====
      {
        id: 27,
        name: "Gaura Parva",
        month: "August/September",
        ethnicGroup: "Far Western Nepal (Doti, Dadeldhura, etc.)",
        location: "Far West hills",
        description: `
<b>Significance:</b>
• Dedicated to Goddess Gaura (Parvati), focusing on marital fidelity.
<b>Rituals & Observances:</b>
• Deuda dance in circles.
• Women perform collective pujas, share blessings.
        `,
        images: [],
        videos: []
      },
      // ===== 3.7 Chasok Tangnam =====
      {
        id: 28,
        name: "Chasok Tangnam",
        month: "November (Full Moon of Kattik/Mangsir)",
        ethnicGroup: "Limbu communities",
        location: "Eastern Nepal (Limbu villages)",
        description: `
<b>Significance:</b>
• Harvest thanksgiving, offering first produce to deities & ancestors.
<b>Celebrations:</b>
• Chyabrung drum dances, communal feasts.
• Tongba (millet drink) often served.
        `,
        images: [],
        videos: []
      },

      // ===== 4.1 Mani Rimdu (3 Main Days + Preparations) =====
      {
        id: 29,
        name: "Mani Rimdu",
        month: "Varies (often Oct/Nov)",
        ethnicGroup: "Sherpa, Tibetan Buddhist communities",
        location: "Solu-Khumbu (Tengboche, Thame, Chiwong)",
        description: `
<b>Significance:</b>
• Tibetan Buddhist festival for world peace, removing negative forces.
<b>Key Elements:</b>
• Sand mandala creation, Wong (empowerment), Cham (masked dances), Fire Puja.
        `,
        images: [],
        videos: []
      },
      // ===== 4.2 Tiji Festival (3 Days) =====
      {
        id: 30,
        name: "Tiji Festival",
        month: "May (27th–29th day of 3rd Tibetan month)",
        ethnicGroup: "Mustang (Lo Manthang)",
        location: "Upper Mustang",
        description: `
<b>Significance:</b>
• Celebrates deity Dorje Jono’s victory over demons causing drought.
<b>Day-by-Day Highlights:</b>
• Masked dances narrate the story of warding off evil, prayers for rains.
        `,
        images: [],
        videos: []
      },
      // ===== 4.3 Gunla (1 Month) =====
      {
        id: 31,
        name: "Gunla (1 Month)",
        month: "~August/September (Nepal Sambat)",
        ethnicGroup: "Newar Buddhist communities",
        location: "Kathmandu Valley (Swayambhu, local bahals)",
        description: `
<b>Significance:</b>
• Sacred month of pilgrimage, reflection, generosity.
<b>Observances:</b>
• Early-morning visits to stupas with Gunla baja.
• Fasting, almsgiving, art exhibitions of paubha or manuscripts.
        `,
        images: [],
        videos: []
      },

      // ===== 5.1 Seto Machhindranath Jatra (3–4 Days) =====
      {
        id: 32,
        name: "Seto Machhindranath Jatra",
        month: "March/April",
        ethnicGroup: "Newar (Kathmandu city)",
        location: "Ason, Indra Chowk, Basantapur",
        description: `
<b>Deity Significance:</b>
• Seto Machhindranath (Karunamaya) for rain and compassion.
<b>Rituals:</b>
• Chariot construction & pulling through old city lanes.
        `,
        images: [],
        videos: []
      },
      // ===== 5.2 Rato Machhindranath Jatra (Weeks to Over a Month) =====
      {
        id: 33,
        name: "Rato Machhindranath Jatra",
        month: "Begins around April/May",
        ethnicGroup: "Newar (Patan)",
        location: "Patan (Lalitpur)",
        description: `
<b>Deity Significance:</b>
• Rato Machhindranath (Bungadya), god of rain and harvest.
<b>Timeline & Observances:</b>
• Tall chariot pulled through Patan neighborhoods.
• Bhoto Jatra finale at Jawalakhel (display of jewel-studded vest).
        `,
        images: [],
        videos: []
      },
      // ===== 5.3 Biska (Bisket) Jatra (~8–9 Days) =====
      {
        id: 34,
        name: "Biska (Bisket) Jatra",
        month: "Mid-April (coincides with Nepali New Year)",
        ethnicGroup: "Newar (Bhaktapur)",
        location: "Bhaktapur Durbar Square, Taumadhi Square",
        description: `
<b>Significance:</b>
• Local new year festival involving legendary serpent tales.
<b>Key Events:</b>
• Chariot tug-of-war for Bhairava & Bhadrakali.
• Erection & lowering of Yoshi (pole) as an omen.
        `,
        images: [],
        videos: []
      },
      // ===== 5.4 Bajra Yogini Jatra =====
      {
        id: 35,
        name: "Bajra Yogini Jatra",
        month: "April/May",
        ethnicGroup: "Newar (Sankhu area)",
        location: "Sankhu, northeast of Kathmandu",
        description: `
<b>Deity Significance:</b>
• Tantric Buddhist goddess representing supreme knowledge.
<b>Rituals & Observances:</b>
• Procession carrying the goddess’s image.
• Temple illuminated with butter lamps.
        `,
        images: [],
        videos: []
      },
      // ===== 5.5 Pahan Charhe =====
      {
        id: 36,
        name: "Pahan Charhe",
        month: "March/April (Chaitra/Baisakh)",
        ethnicGroup: "Newar communities",
        location: "Kathmandu Valley",
        description: `
<b>Significance:</b>
• Worship of local mother goddesses and protective deities.
<b>Observances:</b>
• Family feasts, inviting married daughters home.
• Processions with deity replicas and light offerings.
        `,
        images: [],
        videos: []
      },
      // ===== 5.6 Pachali Bhairav Jatra =====
      {
        id: 37,
        name: "Pachali Bhairav Jatra",
        month: "October/November",
        ethnicGroup: "Newar (Kathmandu)",
        location: "Pachali Bhairav Temple area",
        description: `
<b>Deity Significance:</b>
• A fierce form of Shiva (Bhairav).
<b>Celebrations:</b>
• Deity procession, possible animal sacrifices, communal feasts.
        `,
        images: [],
        videos: []
      },
      // ===== 5.7 Kartik Naach =====
      {
        id: 38,
        name: "Kartik Naach",
        month: "October/November (Kartik)",
        ethnicGroup: "Newar (Patan)",
        location: "Patan Durbar Square",
        description: `
<b>Significance:</b>
• Historical dance-drama from Malla era.
• Depicts Hindu mythological tales.
<b>Performance Details:</b>
• Evening shows over several days/weeks.
• Elaborate costumes and narratives.
        `,
        images: [],
        videos: []
      },
      // ===== 5.8 Sikali Jatra (Khokana) =====
      {
        id: 39,
        name: "Sikali Jatra",
        month: "During Dashain (Maha Ashtami/Mahanavami)",
        ethnicGroup: "Newar (Khokana, Lalitpur)",
        location: "Khokana village",
        description: `
<b>Significance:</b>
• Locals worship Sikali Mata instead of mainstream Durga forms.
<b>Unique Aspects:</b>
• Masked dances in open fields, no animal sacrifices.
        `,
        images: [],
        videos: []
      },
      // ===== 5.9 Gathamuga (Gatha: Muga) Chahre =====
      {
        id: 40,
        name: "Gathamuga (Gatha: Muga) Chahre",
        month: "July/August (before rice planting)",
        ethnicGroup: "Newar communities",
        location: "Kathmandu Valley",
        description: `
<b>Significance:</b>
• Driving away malevolent spirits before monsoon.
<b>Rituals:</b>
• Burning straw effigies at crossroads.
• House cleaning, installing fresh protective charms.
        `,
        images: [],
        videos: []
      },
      // ===== 5.10 Matya =====
      {
        id: 41,
        name: "Matya",
        month: "August (day after Gai Jatra in Patan)",
        ethnicGroup: "Newar (Patan)",
        location: "Patan (Lalitpur)",
        description: `
<b>Significance:</b>
• A festival of lights commemorating departed ancestors.
<b>Observances:</b>
• Long barefoot procession, lighting candles/incense at numerous shrines.
• Traditional musical accompaniment.
        `,
        images: [],
        videos: []
      },
      // ===== 5.11 Khadga Jatra & Devi Naach (Bhaktapur) =====
      {
        id: 42,
        name: "Khadga Jatra & Devi Naach",
        month: "During Dashain (often Mahanavami)",
        ethnicGroup: "Newar (Bhaktapur)",
        location: "Bhaktapur",
        description: `
<b>Significance:</b>
• Display of ancestral swords (khadga).
• Ritual dances for goddesses like Bhadrakali, Mahakali.
<b>How It’s Celebrated:</b>
• Procession of antique swords.
• Devi Naach with costumed dancers blessing the community.
        `,
        images: [],
        videos: []
      },

      // ===== 6.1 Siruwa Parwa (Tharu New Year) =====
      {
        id: 43,
        name: "Siruwa Parwa (Tharu New Year)",
        month: "Mid-April (varies), or around Maghe Sankranti for some",
        ethnicGroup: "Tharu communities",
        location: "Tarai region",
        description: `
<b>Significance:</b>
• Tharu New Year or harvest festival (depending on subgroup).
<b>Rituals & Observances:</b>
• Folk dances (jhumra, dhamar), feasts with local produce.
• Exchange of local gifts, produce.
        `,
        images: [],
        videos: []
      },
      // ===== 6.2 Ghode Jatra (Tundikhel) =====
      {
        id: 44,
        name: "Ghode Jatra (Tundikhel)",
        month: "March/April",
        ethnicGroup: "Nationwide (especially Kathmandu)",
        location: "Tundikhel, central Kathmandu",
        description: `
<b>Significance:</b>
• Horse festival to subdue the demon Gurumapa.
• Historically showcased cavalry skills to royals.
<b>Key Observances:</b>
• Military parades, horse races, government dignitaries in attendance.
        `,
        images: [],
        videos: []
      },
      // ===== 6.3 Khaptad Mela =====
      {
        id: 45,
        name: "Khaptad Mela",
        month: "July/August (dates vary)",
        ethnicGroup: "Pilgrims to Khaptad National Park",
        location: "Khaptad region (Far Western Nepal)",
        description: `
<b>Significance:</b>
• Pilgrimage to Khaptad Baba’s ashram.
• Spiritual renewal in pristine natural setting.
<b>Activities:</b>
• Treks, setting up camps, morning/evening aarti in the forest meadows.
        `,
        images: [],
        videos: []
      },
      // ===== 6.4 Dhan Nach & Chyabrung Nach (Rai & Limbu) =====
      {
        id: 46,
        name: "Dhan Nach & Chyabrung Nach",
        month: "Often during Ubhauli/Udhauli",
        ethnicGroup: "Rai & Limbu communities",
        location: "Eastern Nepal",
        description: `
<b>Significance:</b>
• Celebrations of agricultural cycles, reverence for ancestors.
<b>Dance Details:</b>
• Dhan Nach (Rai): group sword-like dance steps.
• Chyabrung Nach (Limbu): rhythmic drumming with large chyabrung drums.
        `,
        images: [],
        videos: []
      },
      // ===== 6.5 Tila Jatra (Tila Puja) =====
      {
        id: 47,
        name: "Tila Jatra (Tila Puja)",
        month: "Varies in Western Nepal",
        ethnicGroup: "Local communities (Dailekh, Surkhet, etc.)",
        location: "Mid-West districts",
        description: `
<b>Significance:</b>
• Thanksgiving to water deities after harvest.
<b>Observances:</b>
• Prayers at rivers, springs.
• Small fairs with handicrafts and local produce.
        `,
        images: [],
        videos: []
      },
      // ===== 6.6 Badadev / Bhadra Mela =====
      {
        id: 48,
        name: "Badadev / Bhadra Mela",
        month: "August/September",
        ethnicGroup: "Mid- and Far-West communities",
        location: "Mid-/Far-West regions",
        description: `
<b>Significance:</b>
• Honoring local protective deities.
• Often aligns with Gaura Parva.
<b>Celebrations:</b>
• Folk dances, stalls selling crafts, communal feasts.
        `,
        images: [],
        videos: []
      },

      // ===== 7.1 Swasthani Brata Katha (~30 Days) =====
      {
        id: 49,
        name: "Swasthani Brata Katha (~30 Days)",
        month: "January/February",
        ethnicGroup: "Hindu (particularly women)",
        location: "Nationwide; special significance at Salinadi (Sankhu)",
        description: `
<b>Significance:</b>
• Devotion to Goddess Swasthani & Lord Shiva.
• Emphasizes marital fidelity, dedication, moral virtues.
<b>Observances:</b>
• 30-day reading of Swasthani Brata Katha.
• Many women fast, break it on the final full moon day.
        `,
        images: [],
        videos: []
      },
      // ===== 7.2 Gunla (Listed in 4.3 as well) =====
      {
        id: 50,
        name: "Gunla (Month-Long Observance)",
        month: "~August/September (Nepal Sambat)",
        ethnicGroup: "Newar Buddhists",
        location: "Kathmandu Valley (Swayambhu, Boudha, bahals)",
        description: `
(See also festival #31)
<b>Significance:</b>
• Month-long Buddhist retreat with morning pilgrimages, almsgiving.
        `,
        images: [],
        videos: []
      },

      // ===== 8.1 Krishna Janmashtami =====
      {
        id: 51,
        name: "Krishna Janmashtami",
        month: "August/September (Bhadra Krishna Ashtami)",
        ethnicGroup: "Hindu (Vishnu devotees)",
        location: "Nationwide; main temple at Patan (Krishna Mandir)",
        description: `
<b>Significance:</b>
• Birth of Lord Krishna, 8th avatar of Vishnu.
<b>Rituals & Observances:</b>
• Fasting until midnight, bhajan singing, temple gatherings.
• Midnight celebration distributing sweets.
        `,
        images: [],
        videos: []
      },
      // ===== 8.2 Sithi Nakha =====
      {
        id: 52,
        name: "Sithi Nakha",
        month: "May/June (6th day of bright half of Jestha)",
        ethnicGroup: "Newar communities",
        location: "Kathmandu Valley (especially wells, ponds)",
        description: `
<b>Significance:</b>
• Dedicated to Lord Kumar (Kartikeya).
• Day for cleaning wells, ponds before monsoon.
<b>Activities:</b>
• Well-cleaning, communal efforts for fresh water.
• Cooking wo (lentil pancakes) and other Newar delicacies.
        `,
        images: [],
        videos: []
      },
      // ===== 8.3 Ganesh Chaturthi =====
      {
        id: 53,
        name: "Ganesh Chaturthi",
        month: "August/September (Bhadra Shukla Chaturthi)",
        ethnicGroup: "Hindu (Ganesh devotees)",
        location: "Ganesh temples nationwide",
        description: `
<b>Significance:</b>
• Commemorates Lord Ganesh’s birth, remover of obstacles.
<b>Key Observances:</b>
• Offerings of modak, laddu, fruits (Ganesh’s favorites).
• Temple visits, chanting Ganesh mantras.
        `,
        images: [],
        videos: []
      },
      // ===== 8.4 Nepal Sambat New Year (Mha Puja Day) =====
      {
        id: 54,
        name: "Nepal Sambat New Year (Mha Puja Day)",
        month: "Coincides with Tihar’s 4th day (Mha Puja)",
        ethnicGroup: "Newar communities",
        location: "Kathmandu Valley",
        description: `
<b>Significance:</b>
• Marks the start of Newar cultural/lunar calendar (Nepal Sambat).
• Mha Puja: Ritual cleansing, worship of the self.
<b>Observances:</b>
• Mandalas for each family member, blessings, and feasting.
        `,
        images: [],
        videos: []
      },
      // ===== 8.5 Phaguwa / Siruwa Pawai (Tharu Holi) =====
      {
        id: 55,
        name: "Phaguwa / Siruwa Pawai (Tharu Holi)",
        month: "Around Holi (Falgun Purnima)",
        ethnicGroup: "Tharu communities",
        location: "Tarai region",
        description: `
<b>Significance:</b>
• Tharu version of Holi, celebrating spring with unique cultural flair.
<b>Rituals:</b>
• Folk dances, drumming, color play.
• Sharing traditional Tharu sweets.
        `,
        images: [],
        videos: []
      },
      // ===== 8.6 Loktantra Diwas, Republic Day, Constitution Day =====
      {
        id: 56,
        name: "Loktantra Diwas, Republic Day, Constitution Day",
        month: "Various (Loktantra: Apr 24, Republic: May 28, Constitution: Sep 20)",
        ethnicGroup: "Nationwide (political observances)",
        location: "Government offices, public squares",
        description: `
<b>Significance:</b>
• Commemorate Nepal’s key political milestones.
<b>How Observed:</b>
• Parades, official speeches, flag hoisting.
• School/college programs on democracy.
        `,
        images: [],
        videos: []
      }
    ];


    // ========== GLOBAL STATE ==========
    let currentPage = 1;
    let festivalsPerPage = 6; // changes based on viewport (6–9–12)
    let currentSearchTerm = "";
    let filteredFestivals = [...festivalData];

    // ========== DOM ELEMENTS ==========
    const searchInput = document.getElementById("searchInput");
    const festivalList = document.getElementById("festivalList");
    const paginationControls = document.getElementById("paginationControls");
    const festivalModal = document.getElementById("festivalModal");
    const closeModalBtn = document.getElementById("closeModal");
    const modalBackBtn = document.getElementById("modalBackBtn");
    const modalFestivalName = document.getElementById("modalFestivalName");
    const modalMonth = document.getElementById("modalMonth");
    const modalEthnicGroup = document.getElementById("modalEthnicGroup");
    const modalLocation = document.getElementById("modalLocation");
    const modalDescription = document.getElementById("modalDescription");
    const modalImages = document.getElementById("modalImages");
    const modalVideos = document.getElementById("modalVideos");

    // ========== ON PAGE LOAD ==========
    window.addEventListener("load", () => {
      // 1. Read from localStorage first
      const savedSearch = localStorage.getItem("festivals_search") || "";
      const savedPage = localStorage.getItem("festivals_page") || "1";

      // 2. Then read from URL (which can override localStorage)
      const urlParams = new URLSearchParams(window.location.search);

      if (urlParams.has("search")) {
        currentSearchTerm = urlParams.get("search");
      } else {
        currentSearchTerm = savedSearch;
      }

      if (urlParams.has("page")) {
        const pageParam = parseInt(urlParams.get("page"), 10);
        currentPage = isNaN(pageParam) ? parseInt(savedPage, 10) : pageParam;
      } else {
        currentPage = parseInt(savedPage, 10);
      }

      if (!currentPage || currentPage < 1) {
        currentPage = 1;
      }

      // Update search box
      searchInput.value = currentSearchTerm;

      applySearchAndRender(currentSearchTerm, currentPage);
    });

    // ========== EVENT LISTENERS ==========
    searchInput.addEventListener("input", () => {
      currentSearchTerm = searchInput.value.toLowerCase();
      currentPage = 1;
      updateURLAndStorage();
      applySearchAndRender(currentSearchTerm, currentPage);
    });

    closeModalBtn.addEventListener("click", closeModal);
    modalBackBtn.addEventListener("click", closeModal);

    // If user clicks outside the modal content
    window.addEventListener("click", (event) => {
      if (event.target === festivalModal) {
        closeModal();
      }
    });

    // On resize, we might change items/page, so reset page=1
    window.addEventListener("resize", () => {
      currentPage = 1;
      updateURLAndStorage();
      renderFestivals();
    });

    // ========== UTILITY: Update Both URL & LocalStorage ==========
    function updateURLAndStorage() {
      // 1. localStorage
      localStorage.setItem("festivals_search", currentSearchTerm);
      localStorage.setItem("festivals_page", currentPage.toString());

      // 2. URL
      const url = new URL(window.location);
      url.searchParams.set("search", currentSearchTerm);
      url.searchParams.set("page", currentPage);
      window.history.replaceState({}, "", url.toString());
    }

    // ========== FILTERING + RENDERING ==========
    function applySearchAndRender(searchTerm, page) {
      // Filter festivals
      filteredFestivals = festivalData.filter((fest) => {
        const nameMatch = fest.name.toLowerCase().includes(searchTerm);
        const monthMatch = fest.month.toLowerCase().includes(searchTerm);
        const groupMatch = fest.ethnicGroup.toLowerCase().includes(searchTerm);
        return nameMatch || monthMatch || groupMatch;
      });

      currentPage = page;
      renderFestivals();
    }

    function renderFestivals() {
      // Decide how many items per page (6–9–12)
      updateFestivalsPerPage();

      // Clear old cards
      festivalList.innerHTML = "";

      const totalPages = Math.ceil(filteredFestivals.length / festivalsPerPage);

      // Keep currentPage in range
      if (currentPage > totalPages && totalPages > 0) {
        currentPage = totalPages;
      } else if (totalPages === 0) {
        currentPage = 1; // no results -> page=1
      }

      // Slice
      const startIndex = (currentPage - 1) * festivalsPerPage;
      const endIndex = startIndex + festivalsPerPage;
      const festivalsToShow = filteredFestivals.slice(startIndex, endIndex);

      // Create festival cards
      festivalsToShow.forEach((festival) => {
        const card = document.createElement("div");
        card.className = "festival-card";
        card.innerHTML = `
          <h2>${festival.name}</h2>
          <p><strong>Month:</strong> ${festival.month}</p>
          <p><strong>Group:</strong> ${festival.ethnicGroup}</p>
        `;
        card.addEventListener("click", () => openModal(festival));
        festivalList.appendChild(card);
      });

      renderPagination(totalPages);
    }

    function renderPagination(totalPages) {
      paginationControls.innerHTML = "";
      if (totalPages <= 1) return; // no pagination needed if only 1 page

      // Prev
      const prevBtn = document.createElement("button");
      prevBtn.textContent = "Prev";
      prevBtn.className = "page-button" + (currentPage === 1 ? " disabled" : "");
      prevBtn.disabled = (currentPage === 1);
      prevBtn.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          updateURLAndStorage();
          renderFestivals();
        }
      });
      paginationControls.appendChild(prevBtn);

      // Ellipses
      const pages = getPaginationRange(currentPage, totalPages, 2);
      pages.forEach((p) => {
        if (p === "...") {
          const ellipsis = document.createElement("button");
          ellipsis.textContent = "...";
          ellipsis.className = "ellipsis page-button";
          ellipsis.disabled = true;
          paginationControls.appendChild(ellipsis);
        } else {
          const pageBtn = document.createElement("button");
          pageBtn.textContent = p;
          pageBtn.className = "page-button" + (p === currentPage ? " active" : "");
          pageBtn.addEventListener("click", () => {
            currentPage = p;
            updateURLAndStorage();
            renderFestivals();
          });
          paginationControls.appendChild(pageBtn);
        }
      });

      // Next
      const nextBtn = document.createElement("button");
      nextBtn.textContent = "Next";
      nextBtn.className = "page-button" + (currentPage === totalPages ? " disabled" : "");
      nextBtn.disabled = (currentPage === totalPages);
      nextBtn.addEventListener("click", () => {
        if (currentPage < totalPages) {
          currentPage++;
          updateURLAndStorage();
          renderFestivals();
        }
      });
      paginationControls.appendChild(nextBtn);
    }

    // Decide items/page based on viewport
    function updateFestivalsPerPage() {
      const width = window.innerWidth;
      if (width < 768) {
        festivalsPerPage = 6;
      } else if (width < 1024) {
        festivalsPerPage = 9;
      } else {
        festivalsPerPage = 12;
      }
    }

    function getPaginationRange(current, total, delta = 2) {
      // smaller delta on tiny screens
      if (window.innerWidth < 600) {
        delta = 1;
      }
      const pages = [];
      const c = Math.max(1, Math.min(current, total));

      // Always page 1
      pages.push(1);

      if (c - delta > 2) {
        pages.push("...");
      }

      for (let i = Math.max(2, c - delta); i <= Math.min(total - 1, c + delta); i++) {
        pages.push(i);
      }

      if (c + delta < total - 1) {
        pages.push("...");
      }

      // Always last page
      if (total > 1) {
        pages.push(total);
      }
      return pages;
    }

    // ========== MODAL LOGIC ==========
    function openModal(festival) {
      modalFestivalName.textContent = festival.name;
      modalMonth.textContent = festival.month || "N/A";
      modalEthnicGroup.textContent = festival.ethnicGroup || "N/A";
      modalLocation.textContent = festival.location || "N/A";
      modalDescription.innerHTML = festival.description || "No description available.";

      // Images
      modalImages.innerHTML = "";
      if (festival.images && festival.images.length > 0) {
        festival.images.forEach((imgSrc) => {
          const img = document.createElement("img");
          img.src = imgSrc;
          img.alt = festival.name;
          modalImages.appendChild(img);
        });
      }

      // Videos
      modalVideos.innerHTML = "";
      if (festival.videos && festival.videos.length > 0) {
        festival.videos.forEach((vidSrc) => {
          const video = document.createElement("video");
          video.controls = true;
          const source = document.createElement("source");
          source.src = vidSrc;
          source.type = "video/mp4";
          video.appendChild(source);
          modalVideos.appendChild(video);
        });
      }

      festivalModal.style.display = "block";
    }

    function closeModal() {
      festivalModal.style.display = "none";
    }
  </script>
</body>
</html>
